## 7.1

新的一个月，开始学习了！

### 1.2.3、订单管理

点击订单管理

![image-20220701084853077](七月/image-20220701084853077.png)

![image-20220701084955250](七月/image-20220701084955250.png)



![image-20220701085006093](七月/image-20220701085006093.png)

![image-20220701085038249](七月/image-20220701085038249.png)

#### 填写订单

![image-20220701090601487](七月/image-20220701090601487.png)

![image-20220701101404332](七月/image-20220701101404332.png)

![image-20220701101604021](七月/image-20220701101604021.png)

搜索按钮

![image-20220701101847754](七月/image-20220701101847754.png)

![image-20220701102451613](七月/image-20220701102451613.png)

![image-20220701102613831](七月/image-20220701102613831.png)

依旧是模糊搜索

生成订单时

![image-20220701102657038](七月/image-20220701102657038.png)

**![image-20220701102913158](七月/image-20220701102913158.png)**

 填写订单

![image-20220701103110097](七月/image-20220701103110097.png)

保存考生订单信息

![image-20220701103130246](七月/image-20220701103130246.png)

![image-20220701103859049](七月/image-20220701103859049.png)

![image-20220701110158515](七月/image-20220701110158515.png)



订单确认

![image-20220701110241978](七月/image-20220701110241978.png)

![image-20220701112132938](七月/image-20220701112132938.png)

最主要的逻辑就是判断支付的商户类型；



#### 作废订单

![image-20220701114901490](七月/image-20220701114901490.png)

没有中间逻辑，直接跳转到作废页面

![image-20220701134556819](七月/image-20220701134556819.png)

![image-20220701134640245](七月/image-20220701134640245.png)

![image-20220701140357052](七月/image-20220701140357052.png)

其实就是更改数据的状态

#### 撤销作废订单

![image-20220701140508594](七月/image-20220701140508594.png)

前端脚本代码首先会判断一下选取的订单状态是否为作废状态，为作废状态才执行下一步；

![image-20220701140848369](七月/image-20220701140848369.png)

![image-20220701141053485](七月/image-20220701141053485.png)

撤销订单就是再将订单状态改回来

#### 确认订单

就是在缴费前再进行一次确认订单信息

![image-20220701141846772](七月/image-20220701141846772.png)

![image-20220701142645904](七月/image-20220701142645904.png)

![image-20220701143641464](七月/image-20220701143641464.png)

订单确定之后就会进行缴费

批量确认订单

<img src="七月/image-20220701160419803.png" alt="image-20220701160419803" style="zoom:100%;" />

![image-20220701160646087](七月/image-20220701160646087.png)

![image-20220701160741953](七月/image-20220701160741953.png)

![image-20220701160803221](七月/image-20220701160803221.png)

![image-20220701161649271](七月/image-20220701161649271.png)

循环操作选中的所有订单

然后再依次调用确认订单的方法；

![image-20220701161736176](七月/image-20220701161736176.png)



#### 网上缴费确认信息查询

![image-20220701163919745](七月/image-20220701163919745.png)

通过后端传回来的参数来查询

![image-20220701164636953](七月/image-20220701164636953.png)

通过不同的值来跳转不同的页面；

![image-20220701170006904](七月/image-20220701170006904.png)

跳转到前端，然后触发点击事件。

![image-20220701170205145](七月/image-20220701170205145.png)

每个jsp调用的方法都不是一样的支付接口；



#### 退费

![image-20220701171058817](七月/image-20220701171058817.png)

首先前端会判断一下是否是已缴费的状态，是已缴费的状态才会继续向下走；

![image-20220701171559106](七月/image-20220701171559106.png)

![image-20220701173337048](七月/image-20220701173337048.png)

#### 

## 7.2

找狗剩子拿毕业证

## 7.3

周末休息

城市天际线

下棋

## 7.4

### 1.2.3、订单管理

#### 网上退费信息查询

![image-20220704092406791](七月/image-20220704092406791.png)

首先先判断你是否选择了订单，然后再去判断你的状态，前端判断你的状态是否符合网上退费的条件，满足了再向下走；

![image-20220704101538133](七月/image-20220704101538133.png)

调用控制层，根据商户类型的不同，跳转到不同的页面。

![image-20220704103328033](七月/image-20220704103328033.png)

退款详细页面

![image-20220704104422851](七月/image-20220704104422851.png)

### oracle修改数据

遇到一直执行的情况，百度发现是有执行的语句没有提交事务，要杀掉会话，才可以执行新的更改

```sql
select sess.sid,
sess.serial#,
lo.oracle_username,
lo.os_user_name,
ao.object_name,
lo.locked_mode
from v$locked_object lo, dba_objects ao, v$session sess
where ao.object_id = lo.object_id
and lo.session_id = sess.sid;
--杀掉会话
alter system kill session 'sid,serial#'; 

update kit.sojourn_coll_rounds set lc='2' where KSID = '20022062910000000167'
select * from  kit.sojourn_coll_rounds where KSID = '20022062910000000167'

```

### 1.2.4、对账管理



### 公司中git的使用

![image-20220704140021688](七月/image-20220704140021688.png)

https://www.cnblogs.com/mengcheng9300/p/12955591.html



## 7.5

安装DBeaver 

tip

### 对账管理

### 1.3、网上报名统计查询

#### 1.3.1、考生报考统计情况

点击左侧菜单栏的考生报考情况统计----》

![image-20220705104953879](七月/image-20220705104953879.png)

然后跳转到biz

![image-20220705105426210](七月/image-20220705105426210.png)

进行数据查询，然后返回给/pageQueryTaskStdnt.jsp页面

![image-20220705105502664](七月/image-20220705105502664.png)

#### 1.3.2、职位报考统计

点击菜单栏职位报考人数统计页面

![image-20220705110211851](七月/image-20220705110211851.png)

直接跳转到jsp页面，jsp页面的查询操作

![image-20220705110729942](七月/image-20220705110729942.png)

跳转到控制层

![image-20220705120017813](七月/image-20220705120017813.png)

![image-20220705120115308](七月/image-20220705120115308.png)

一样的操作，通过sql语句查询数据库，然后返回参数给页面

#### 1.3.3、手机号码查询

![image-20220705140310332](七月/image-20220705140310332.png)

![image-20220705140400619](七月/image-20220705140400619.png)

查询功能

![image-20220705140428769](七月/image-20220705140428769.png)

![image-20220705140450500](七月/image-20220705140450500.png)

![image-20220705140530640](七月/image-20220705140530640.png)

去数据库查看数据

![image-20220705141613032](七月/image-20220705141613032.png)

存在数据，但是不知道什么原因查询不出来

#### 1.3.4、按职位查询考生报考信息

![image-20220705144546172](七月/image-20220705144546172.png)

首先进行一个查询

![image-20220705144620614](七月/image-20220705144620614.png)

查询的数据保存起来，后面会用到

点击查询没反应



### 考生端

没有账号，从管理端点击考生的模拟登录

即可跳转到考生端

![image-20220705160414862](七月/image-20220705160414862.png)



![image-20220705161925535](七月/image-20220705161925535.png)

跳转到模拟登录页面

![image-20220705161945169](七月/image-20220705161945169.png)

根据sql语句查看表里的功能

![image-20220705162300459](七月/image-20220705162300459.png)

| 考试公告                   | wechatrg.do?method=fwdNoticePage    |
| -------------------------- | ----------------------------------- |
| 当前考试                   | wechatrg.do?method=fwdCurrentPage   |
| 我的报考                   | wechatrg.do?method=fwdMinePage      |
| 我的关注                   | wechatrg.do?method=fwdMineFocusPage |
| 个人信息                   | wechatrg.do?method=fwdMineInfoPage  |
| 加&nbsp;分&nbsp;申&nbsp;请 | stdba.do?method=fwdStdBunusApplyMng |

#### 1、考试公告

![image-20220705163135740](七月/image-20220705163135740.png)

![image-20220705163819517](七月/image-20220705163819517.png)

去查看表结构

![image-20220705165830103](七月/image-20220705165830103.png)

#### 2、当前考试

![image-20220705170310844](七月/image-20220705170310844.png)

![image-20220705171243692](七月/image-20220705171243692.png)

首先需要判断报考人员是否存在，不存在则直接报错

后面还会查询考试信息；

然后前端将考试信息循环遍历

![image-20220705171906433](七月/image-20220705171906433.png)

![image-20220705172022864](七月/image-20220705172022864.png)

使用if判断显示的按钮的样式

## 7.6

### 考生端

#### 3、报名流程

![image-20220705173408529](七月/image-20220705173408529.png)

![image-20220705173440288](七月/image-20220705173440288.png)

检查是否满足报名条件，满足条件既可以报名，否则会提示相应的错误；

![image-20220706085249368](七月/image-20220706085249368.png)

如果之前已经进行了报名，但是没有走完报名流程，按钮将变成进入，如果完成了报名，那么按钮就会变成再次报名

![image-20220706091253194](七月/image-20220706091253194.png)

这个才是转入报名流程页面，点击按钮之后先判断，然后再跳转，严谨

![image-20220706095554240](七月/image-20220706095554240.png)

获取报考信息

在获取报考信息得同时，进行一些查询，比如白名单，比如违纪情况查询

![image-20220706101014624](七月/image-20220706101014624.png)

最后会根据违纪情况来跳转到不同的页面

如有违纪行为，则会跳转到违纪页面

![image-20220706103837922](七月/image-20220706103837922.png)

展示违纪情况

![image-20220706104059331](七月/image-20220706104059331.png)

没有违纪情况则正常显示流程。

![image-20220706104127082](七月/image-20220706104127082.png)



![image-20220706105535769](七月/image-20220706105535769.png)

也是使用if来判断使用哪个按钮

![image-20220706105659251](七月/image-20220706105659251.png)







![image-20220706105639333](七月/image-20220706105639333.png)

![image-20220706110450299](七月/image-20220706110450299.png)

判断需要转向哪个流程的详细页面

3.1、查看简章操作页面

![image-20220706111140219](七月/image-20220706111140219.png)

![image-20220706113229341](七月/image-20220706113229341.png)

![image-20220706113459968](七月/image-20220706113459968.png)

嵌入查询出来的简章模版

![image-20220706114042306](七月/image-20220706114042306.png)

打印

![image-20220706114148927](七月/image-20220706114148927.png)

3.2、进入修改页面

![image-20220706115212054](七月/image-20220706115212054.png)

![image-20220706115432788](七月/image-20220706115432788.png)

![image-20220706115454127](七月/image-20220706115454127.png)

进入修改页面首先要判断修改时间是否在规定时间内

![image-20220706120032323](七月/image-20220706120032323.png)

然后通过各种判断，跳转到不同的页面



3.3、进入

![image-20220706150955642](七月/image-20220706150955642.png)

![image-20220706151049160](七月/image-20220706151049160.png)

与修改和查看类似

![image-20220706151126744](七月/image-20220706151126744.png)

也是进行各种判断，如果不符合条件，则会提示错误信息；

修改的流程没有弄清楚；

#### 4、我的关注

![image-20220706160659151](七月/image-20220706160659151.png)

跳转至我的关注页面

需要注意，这里有两个转向关注页面，一个是考生的，另一个不知道是什么，

![image-20220706163606751](七月/image-20220706163606751.png)

查询关注的项目，以及关注的公告

![image-20220706163859104](七月/image-20220706163859104.png)

![image-20220706164454111](七月/image-20220706164454111.png)

将我的公告内容填充



关注项目管理

![image-20220706171058828](七月/image-20220706171058828.png)



## 7.7

### 考生端

#### 5、我的考试

![image-20220707165333837](七月/image-20220707165333837.png)

需要注意的是这个方法也是有两个，微信的controller中也有一个；

![image-20220707170402267](七月/image-20220707170402267.png)

前端脚本代码

![image-20220707172037539](七月/image-20220707172037539.png)

![image-20220707172813063](七月/image-20220707172813063.png)

![image-20220707172853923](七月/image-20220707172853923.png)

检查是否符合流程

然后转向报名页面

![image-20220707173002217](七月/image-20220707173002217.png)

![image-20220707173027069](七月/image-20220707173027069.png)

然后获取报名流程，这样就和报考考试时差不多了

![image-20220708083404271](七月/image-20220708083404271.png)

转向和考试报名的同一个页面

## 7.8

准备出差工作

## 7.9

泰安

## 7.10

菏泽

## 7.11

使用apifox测试接口

![image-20220711090432031](七月/image-20220711090432031.png)



### 考生端

#### 6、我的信息

![image-20220708091304246](七月/image-20220708091304246.png)



点击我的信息功能按钮，会调用方法进行数据库的查询；

![image-20220711111303541](七月/image-20220711111303541.png)

将数据库中查询到的数据，再放入datamap中传递到前端页面

![image-20220711135914471](七月/image-20220711135914471.png)

修改姓名

![image-20220711140640566](七月/image-20220711140640566.png)

需要将xm放进参数，然后再去访问方法

![image-20220711141628901](七月/image-20220711141628901.png)

首先查询需要修改信息的审核状态，因为需要判断之前是否有修改。修改是否通过

![image-20220711143112402](七月/image-20220711143112402.png)

调用这个方法是没有返回结果的，如果审核通过，或者说是没有进行过信息的修改，那么就会进行下一步数据的修改，如果审核还为通过，那么将会抛出异常；提示审核还未通过；

检查完了之后，进入修改页面

![image-20220711160717439](七月/image-20220711160717439.png)

![image-20220711162827063](七月/image-20220711162827063.png)

![image-20220711163503424](七月/image-20220711163503424.png)

跳出修改信息页面

填写相关信息之后，点击申请修改

![image-20220711164141953](七月/image-20220711164141953.png)

首先进行页面数据的判断，什么图片格式啦，必填信息是否填写啦；

然后再进行保存数据

![image-20220711165552497](七月/image-20220711165552497.png)

![image-20220711170150740](七月/image-20220711170150740.png)

数据参数需要将前端的数据传递过来；



修改身份证号码

![image-20220711170910385](七月/image-20220711170910385.png)

![image-20220711171403323](七月/image-20220711171403323.png)

还是老一套，检查是否在审核

![image-20220711171535727](七月/image-20220711171535727.png)

然后再去跳转到修改页面



![image-20220711173235816](七月/image-20220711173235816.png)

修改页面

![image-20220711173305371](七月/image-20220711173305371.png)

![image-20220711173325513](七月/image-20220711173325513.png)

![image-20220711173337956](七月/image-20220711173337956.png)

保存修改 等待审核

## 7.12-7.17

出差

## 7.18

### 考生端

不知道再怎么看

#### 7、加分申请

![image-20220718090305365](七月/image-20220718090305365.png)

![image-20220718090622561](七月/image-20220718090622561.png)





![image-20220718091307000](七月/image-20220718091307000.png)

jsp详情页面

以及jsp按钮的详细数据流向以及业务逻辑

![image-20220718091518085](七月/image-20220718091518085.png)

![image-20220718091539545](七月/image-20220718091539545.png)

![image-20220718091916593](七月/image-20220718091916593.png)

加分详情页面

![image-20220718092114232](七月/image-20220718092114232.png)

根据类型的不同 调用不同的方法进行处理，跳转的页面也不一样

![image-20220718092856544](七月/image-20220718092856544.png)



![image-20220718092916439](七月/image-20220718092916439.png)

通过调用不同的方法，查询不同的两个职位的信息，然后在前端显示出来；

查看数据库表格类型

![image-20220718093349051](七月/image-20220718093349051.png)

![image-20220718093747730](七月/image-20220718093747730.png)

然后跳转到对应的jsp显示页面

![image-20220718094351662](七月/image-20220718094351662.png)

点击图片预览，进入图片的详细信息

![image-20220718094340839](七月/image-20220718094340839.png)

![image-20220718094511383](七月/image-20220718094511383.png)

![image-20220718094610598](七月/image-20220718094610598.png)



点击加分申请弹出的通知页面

![image-20220718091013421](七月/image-20220718091013421.png)

![image-20220718095644066](七月/image-20220718095644066.png)

![image-20220718095705969](七月/image-20220718095705969.png)



![image-20220718095738933](七月/image-20220718095738933.png)

然后通过数据库查询出模板信息



加分申请信息修改

![image-20220718100214906](七月/image-20220718100214906.png)

和详情一样，分为两个类型

![image-20220718100312954](七月/image-20220718100312954.png)

![image-20220718100618173](七月/image-20220718100618173.png)

![image-20220718100643358](七月/image-20220718100643358.png)

同样是两种页面，调用两种方法

![image-20220718100950118](七月/image-20220718100950118.png)

![image-20220718101840016](七月/image-20220718101840016.png)

 加分详情的修改保存，jsp中的逻辑非常麻烦

![image-20220718102232648](七月/image-20220718102232648.png)

浅看一下即可；

### 单位端

首先先去注册一个账号

![image-20220718110322083](七月/image-20220718110322083.png)

在管理端的管理页面

![image-20220718110355333](七月/image-20220718110355333.png)

加错了

![image-20220718111048100](七月/image-20220718111048100.png)

要使用单位用户管理，而不是单位角色管理，这太麻烦了啊，用户能会使用吗

更新密码为xu739524

因为没有下级单位，所以没有系统管理这个功能；

![image-20220718112748245](七月/image-20220718112748245.png)

只有人事考试这个选项卡

通过使用文档来看数据流向以及业务逻辑



看错了  系统管理与人事考试合并了

![image-20220718114223310](七月/image-20220718114223310.png)

按照文档的顺序来查看各个功能

首先应该先找到功能所对应的超链接

![image-20220718114404547](七月/image-20220718114404547.png)

![image-20220718115602546](七月/image-20220718115602546.png)

找到数据库中存放功能的表

根据表中的信息来进行了解与分析；

#### 系统管理

| 用户权限管理                               |
| ------------------------------------------ |
| url:orgnlogin.do?method=fwdOrgnUserFuncMng |

![image-20220718134731887](七月/image-20220718134731887.png)

![image-20220718135545819](七月/image-20220718135545819.png)

![image-20220718135632862](七月/image-20220718135632862.png)

获取批次以及角色列表





选择角色列表中的一个

![image-20220718135824159](七月/image-20220718135824159.png)

![image-20220718135847857](七月/image-20220718135847857.png)

![image-20220718141527876](七月/image-20220718141527876.png)

![image-20220718141546913](七月/image-20220718141546913.png)

![image-20220718141627685](七月/image-20220718141627685.png)

![image-20220718142301022](七月/image-20220718142301022.png)

 然后会对jsp页面进行刷新

![image-20220718143240491](七月/image-20220718143240491.png)

![image-20220718143250317](七月/image-20220718143250317.png)

#### 新增用户

![image-20220718144342128](七月/image-20220718144342128.png)

![image-20220718144843745](七月/image-20220718144843745.png)

![image-20220718145438337](七月/image-20220718145438337.png)



![image-20220718145541088](七月/image-20220718145541088.png)



保存新增用户

![image-20220718150401392](七月/image-20220718150401392.png)

![image-20220718150835338](七月/image-20220718150835338.png)

![image-20220718151158350](七月/image-20220718151158350.png)

保存新用户逻辑，其实都是先判断库中是否存在，然后在处理一些参数，最后执行插入语句，记录日志，即可

![image-20220718151757255](七月/image-20220718151757255.png)

插入完成之后刷新页面

#### 修改用户

![image-20220718152933605](七月/image-20220718152933605.png)

![image-20220718153812717](七月/image-20220718153812717.png)

![image-20220718154809917](七月/image-20220718154809917.png)

查询数据库中的数据，回显到jsp页面上；

![image-20220718155114495](七月/image-20220718155114495.png)

![image-20220718155133414](七月/image-20220718155133414.png)



![image-20220718155257062](七月/image-20220718155257062.png)

![image-20220718155336283](七月/image-20220718155336283.png)

保存用户无非就是将库中的数据修改，需要注意要开启事务，否则会造成很多的后果；

![image-20220718155917306](七月/image-20220718155917306.png)

然后对页面进行局部刷新

#### 注销用户

![image-20220718160904875](七月/image-20220718160904875.png)

点击注销按钮，会弹出注销理由页面

![image-20220718161625667](七月/image-20220718161625667.png)

![image-20220718161640867](七月/image-20220718161640867.png)

![image-20220718161854519](七月/image-20220718161854519.png)

点击确认之后触发上一个js的逻辑，因为上一个js还没有走完

![image-20220718162005154](七月/image-20220718162005154.png)

弹出理由框之后，点击确认，会调用下一个方法；

![image-20220718163302961](七月/image-20220718163302961.png)

就是将状态码进行修改

#### 撤销注销

![image-20220718163359050](七月/image-20220718163359050.png)

![image-20220718163421593](七月/image-20220718163421593.png)

![image-20220718163449513](七月/image-20220718163449513.png)

也是类似，也是修改状态码

最后进行局部页面的刷新；

#### 删除

![image-20220718165352770](七月/image-20220718165352770.png)

![image-20220718170038536](七月/image-20220718170038536.png)

![image-20220718170332946](七月/image-20220718170332946.png)

删除就比较麻烦了，因为删除得东西很多，所以关联得东西都需要进行删除；

最后会提示删除成功；

#### 密码重置

![image-20220718171553408](七月/image-20220718171553408.png)

首先进行打开窗口时得调用方法，然后在点击保存之后，再去执行另一个方法；

![image-20220718172153532](七月/image-20220718172153532.png)

第一个方法是开启一个窗口；

![image-20220718172223860](七月/image-20220718172223860.png)

点击确认之后，会关闭窗口，继续执行上一个没有执行完得js；

![image-20220718172328401](七月/image-20220718172328401.png)

![image-20220718172611930](七月/image-20220718172611930.png)

直接sql更新密码；

最后弹出密码更新成功窗口；



## 7.19

### 单位端

#### 人事考试-网上报名管理

##### 报名信息审核（终审）

| 报名信息审核(终审)                             |
| ---------------------------------------------- |
| url:orgnrg.do?method=fwdTaskStdntCheck&shlx=30 |

![image-20220719091311376](七月/image-20220719091311376.png)

这个方法中，其实默认都是终审，初审与终审调用得都是一个方法；

![image-20220719091440664](七月/image-20220719091440664.png)

![image-20220719095636154](七月/image-20220719095636154.png)

根据考试类型来判断到底调用哪一个方法

终审与初审都是A类型，所以都是调用a方法，只不过是shlx终审是30，而初审是10

![image-20220719095955053](七月/image-20220719095955053.png)

一级审核，shlx的值不同；

![image-20220719100440778](七月/image-20220719100440778.png)

![image-20220719100447387](七月/image-20220719100447387.png)

没有测试数据，凑活看

###### 查询

![image-20220719101341406](七月/image-20220719101341406.png)

![image-20220719101846202](七月/image-20220719101846202.png)

![image-20220719102542412](七月/image-20220719102542412.png)

![image-20220719104221824](七月/image-20220719104221824.png)

最后异步刷新一下页面





###### 查看详情

![image-20220719110109429](七月/image-20220719110109429.png)

![image-20220719110134147](七月/image-20220719110134147.png)

![image-20220719110623170](七月/image-20220719110623170.png)

![image-20220719110708549](七月/image-20220719110708549.png)

![image-20220719110932870](七月/image-20220719110932870.png)

最后将查询的信息返回到页面

![image-20220719111035135](七月/image-20220719111035135.png)



###### 开始审核

![image-20220719113228041](七月/image-20220719113228041.png)

点击开始审核，通过js调用方法；

![image-20220719113931224](七月/image-20220719113931224.png)

![image-20220719114001971](七月/image-20220719114001971.png)



![image-20220719114051959](七月/image-20220719114051959.png)

![image-20220719114143086](七月/image-20220719114143086.png)



![image-20220719114152488](七月/image-20220719114152488.png)

保存并下一个，保存审核信息并进行下一个审核；

![image-20220719114459356](七月/image-20220719114459356.png)



![image-20220719114552206](七月/image-20220719114552206.png)

![image-20220719114520722](七月/image-20220719114520722.png)



考生信息保存

![image-20220719114911043](七月/image-20220719114911043.png)

###### 撤销审核

![image-20220719135226188](七月/image-20220719135226188.png)

![image-20220719140758158](七月/image-20220719140758158.png)

撤销审核就是对数据库中数据的修改；

最后弹出一个撤销成功的弹窗；

### 考生报名业务流程

对考试报名的整个流程进行了解，包括考生报名，以及管理端的审核，还有就是数据的流向；

。。。。找不到审核页面。。。。

找到了，审核在单位端；

去报名的那个考试的场次，新注册一个用户，然后去审核即可；

![image-20220719152905465](七月/image-20220719152905465.png)

 查看单位端照片审核的数据；

| 考生照片审核                                |
| ------------------------------------------- |
| url:orgnrg.do?method=fwdTaskStdntPhotoCheck |

![image-20220719154920265](七月/image-20220719154920265.png)

![image-20220719155753711](七月/image-20220719155753711.png)

![image-20220719160224299](七月/image-20220719160224299.png)

sql语句中查询的task表中，照片审核状态为01，即未审核状态；

再去查看一下提交照片是否也是提交到这个表中，然后页面查询状态是否也是在这个表中进行查询；

![image-20220719161642697](七月/image-20220719161642697.png)

先从表中获取考生流程

查看

![image-20220719162457195](七月/image-20220719162457195.png)



![image-20220719162440907](七月/image-20220719162440907.png)

![image-20220719162541580](七月/image-20220719162541580.png)

从这两张表中获得对应的考生信息以及考生照片

上传照片到表中

![image-20220719163532723](七月/image-20220719163532723.png)

![image-20220719163611378](七月/image-20220719163611378.png)

![image-20220719163813767](七月/image-20220719163813767.png)

这个是打开上传照片页面，所以说不需要插入图片，他需要对这个页面的数据进行一个判断，看这个用户是否在之前就已经上传过照片，上传过照片就可以使用之前上传的照片，或者提示一些审核的信息。就是在打开上传页面之前，来进行这些判断，从而控制页面的显示情况；

![image-20220719164228592](七月/image-20220719164228592.png)

![image-20220719164615453](七月/image-20220719164615453.png)



![image-20220719165515231](七月/image-20220719165515231.png)

将图片添加到数据库表中



资格审查

![image-20220719170451908](七月/image-20220719170451908.png)

![image-20220719170431222](七月/image-20220719170431222.png)

资格初审

审核通过

初审通过之后会在进行终审

图片通过审核以及资格审核通过之后，就可以进入下一步，支付；

但是支付接口好像没开，直接报错；

## 7.20

### 单位端

#### 考生手机号码查询申请

| 考生手机号码查询申请                   |
| -------------------------------------- |
| url:orgnrg.do?method=fwdApplyQuerySjhm |

![image-20220720085411191](七月/image-20220720085411191.png)

![image-20220720090231064](七月/image-20220720090231064.png)

去数据库中查询数据

然后将数据返回给jsp页面；

![image-20220720090840392](七月/image-20220720090840392.png)

![image-20220720090849954](七月/image-20220720090849954.png)

两个相关的数据表

简单了解一下表结构

![image-20220720091700085](七月/image-20220720091700085.png)



##### 查看-双击查看

![image-20220720092639994](七月/image-20220720092639994.png)

![image-20220720093941056](七月/image-20220720093941056.png)

![image-20220720094043069](七月/image-20220720094043069.png)

从数据库手机号码申请表里查询符合要求的数据

然后显示到jsp页面上；

![image-20220720094659966](七月/image-20220720094659966.png)

双击详情与选择详情使用的是同一个方法；所以说了解一个就可以

##### 新增

![image-20220720094847233](七月/image-20220720094847233.png)

首先新增申请需要注意一些必填的信息；

![image-20220720095238141](七月/image-20220720095238141.png)

![image-20220720095446734](七月/image-20220720095446734.png)

需要注意考试类型

![image-20220720095710765](七月/image-20220720095710765.png)

一般考试类型都是A，一会去弄清楚这个考试类型所代表的东西；

![image-20220720095914179](七月/image-20220720095914179.png)

首先，添加考生

![image-20220720100558227](七月/image-20220720100558227.png)

![image-20220720103143459](七月/image-20220720103143459.png)

![image-20220720103351932](七月/image-20220720103351932.png)

![image-20220720103424014](七月/image-20220720103424014.png)

弹出选择考生窗口

然后点击查询按钮

这个窗口的隐藏数据应该就是批次信息；

![image-20220720104006108](七月/image-20220720104006108.png)

![image-20220720104207332](七月/image-20220720104207332.png)

查询一般用的都是页面部分刷新

![image-20220720104459060](七月/image-20220720104459060.png)

![image-20220720104751195](七月/image-20220720104751195.png)

![image-20220720104755561](七月/image-20220720104755561.png)

![image-20220720104941966](七月/image-20220720104941966.png)

确认选择

选中一个已添加的考生，进行移除

![image-20220720105100239](七月/image-20220720105100239.png)

![image-20220720105114298](七月/image-20220720105114298.png)

新增文件

![image-20220720105516894](七月/image-20220720105516894.png)

![image-20220720105646102](七月/image-20220720105646102.png)

新增文件按钮功能很简单，只是弹出一个选择文件以及文件名称的窗口；

![image-20220720105757012](七月/image-20220720105757012.png)

![image-20220720110410077](七月/image-20220720110410077.png)

![image-20220720110749619](七月/image-20220720110749619.png)

![image-20220720110923365](七月/image-20220720110923365.png)

将文件上传到session中，不知道为什么将文件上传到session中；不太明白

##### 修改

![image-20220720112204325](七月/image-20220720112204325.png)

![image-20220720112729688](七月/image-20220720112729688.png)

![image-20220720112819909](七月/image-20220720112819909.png)

首先先查询，然后将已有数据回显到jsp页面，然后才能修改数据

![image-20220720113249236](七月/image-20220720113249236.png)

![image-20220720113307655](七月/image-20220720113307655.png)

可以保存也可以直接提交审核，比较有用的是直接提交审核。

那就只看提交审核。

![image-20220720114914721](七月/image-20220720114914721.png)

![image-20220720115037477](七月/image-20220720115037477.png)

![image-20220720115106114](七月/image-20220720115106114.png)

更新完毕之后会刷新一下页面

##### 删除

删除手机号码查询申请

![image-20220720120053742](七月/image-20220720120053742.png)

![image-20220720134851112](七月/image-20220720134851112.png)

![image-20220720134951161](七月/image-20220720134951161.png)

将相关联的三个表中的数据全部都要删除掉；

### 单位退费申请

与考生手机号申请类似，其实都是一样的，只不过是数据不一样，业务逻辑是一样的；

| 单位退费申请                         |
| ------------------------------------ |
| url:orgnrg.do?method=fwdApplyReturns |

![image-20220720140236947](七月/image-20220720140236947.png)

![image-20220720144540817](七月/image-20220720144540817.png)

点击左侧单位退费申请功能按钮，执行查询操作，将一些退费的申请查询出来并展示到页面上；

#### 查看

![image-20220720145033842](七月/image-20220720145033842.png)

![image-20220720145520713](七月/image-20220720145520713.png)

![image-20220720145644980](七月/image-20220720145644980.png)









### 任务

![7-20](七月/7-20.png)



先去gitlab看议题！！！

#### 成绩查询管理

![image-20220720171147291](七月/image-20220720171147291.png)







简单的问题，唉



| 成绩查询管理                                |
| ------------------------------------------- |
| url:resultquery.do?method=fwdResultQueryMng |

首先找到代码所在位置

![image-20220720174541845](七月/image-20220720174541845.png)

加载树

![image-20220720174743424](七月/image-20220720174743424.png)





**tip/tip/jsp/kit/rq/treePageResultExamStdMng.jsp**

![image-20220720174809447](七月/image-20220720174809447.png)

```js

//打印准考证
function btnPrintClick(){
    var grid = getObject("gridStd");
    if (!grid.isSelectRow()) {
        alert("请先选择需要打印的准考证信息。");
        return;
    }
    var url = new URL("resultquery.do", "fwdPrintResultExamStdInfo");
    url.addQueryGridSelectData("gridStd", "stdid");
    openWindow("考生准考证打印", url, "big", function(data){
        if(chkObjNull(data)){
            return;
        }
        btnQueryClick();
    });
}

```

改之后

```js

//打印准考证
function btnPrintClick(){
    var grid = getObject("gridStd");
    if (!grid.isSelectRow()) {
        alert("请先选择需要打印成绩单的考生信息。");
        return;
    }
    var url = new URL("resultquery.do", "fwdPrintResultExamStdInfo");
    url.addQueryGridSelectData("gridStd", "stdid");
    openWindow("考生成绩单打印", url, "big", function(data){
        if(chkObjNull(data)){
            return;
        }
        btnQueryClick();
    });
}
```

不知道还需不需要改方法



不需要改方法，只需要改弹出的窗口信息即可

![image-20220721082229856](七月/image-20220721082229856.png)

![image-20220721082336199](七月/image-20220721082336199.png)

第一个任务完成！





### GitLab

先去申请账号

然后熟悉拉代码、新建分支、提交分支

https://blog.csdn.net/m0_53583370/article/details/121329442

首先将ssh密钥添加到gitlab，建立本地与仓库的链接；

生成ssh

```
查看git的用户名与邮箱
git config user.name

git config user.email

生成ssh密钥


ssh-keygen -t rsa -C "your_email@example.com"
代码参数含义： 
-t 指定密钥类型，默认是 rsa ，可以省略。 
-C 设置注释文字，比如邮箱。 
-f 指定密钥文件存储文件名。

ssh-keygen -t rsa -C "xuzb_1730765741@qq.com_nomax_gitlab"

xu输入密码：push时候需要密码 739524     


拷贝密钥
 clip < ~/.ssh/id_rsa.pub

拷贝到gitlab上即可
```



## 7.21

### 新疆自治区一体化平台-单位业务管理-职位限制条件维护

想要登录新疆的一体化平台，需要切换dbid；

![image-20220721085554395](七月/image-20220721085554395.png)

然后去项目中切换dbid即可

![image-20220721085809850](七月/image-20220721085809850.png)





切换dbid不换显示效果；

只是更换客户化

```sql
select * from fw.local_config;
select * from fw.local_doc;
```

查看config表

就是会指定某个dbid下，某个页面或者某个方法，不走标准件，而是走客户化

见到那种带_101，就是带dbid后缀的

![image-20220721093309522](七月/image-20220721093309522.png)

一会打个断点试一下

![image-20220721094053408](七月/image-20220721094053408.png)

打断点发现就是走的100jsp页面



开始修改错误

找到出现问题的页面

![image-20220721094525229](七月/image-20220721094525229.png)



![image-20220721094800571](七月/image-20220721094800571.png)



仿造新增，在修改页面稍微修改一下即可

![image-20220721094907589](七月/image-20220721094907589.png)



![image-20220721103227751](七月/image-20220721103227751.png)

增加了一个回显数据框

![image-20220721103531606](七月/image-20220721103531606.png)

![image-20220721103659901](七月/image-20220721103659901.png)

![image-20220721103809958](七月/image-20220721103809958.png)



修改完成！

但是不知道有没有其他关联的地方没有修改完全；

![image-20220721104053824](七月/image-20220721104053824.png)

测试，数据库中数据正常修改，没有什么出现报错的地方；

![image-20220721104240174](七月/image-20220721104240174.png)

直接将新增页面的下拉框拿过来就行，把那个默认数据给删了，就ok了；

![image-20220721105951451](七月/image-20220721105951451.png)

提交代码

提交完成；

没有申请合并。

每次改问题都需要新建一个分支

![image-20220721114140281](七月/image-20220721114140281.png)

又稍微修改了一下

将if条件去除

还是不能去！

因为在添加的时候，就有判断，当数字等于1的时候才有这个可选项，那么修改的时候肯定也要有这个判断，否则当数字不等于1的时候呢



### tip业务流程

工作完成，继续去看业务流程

看两个算法吧！

## 7.22

还是继续看业务流程吗？

继续看吧





复习之前所学知识，遗忘太快！

准备搭建个人动态博客！

### 考务系统

查找左侧功能栏的url，有的没找到，不知道怎么回事

| 功能名称             | url地址                                   |
| -------------------- | ----------------------------------------- |
| 考试设置向导         | url:exam.do?method=fwdExamSetting         |
| 考试管理             | url:exam.do?method=fwdExamManage          |
| 考试批次管理         | url:exam.do?method=fwdTaskManage          |
| 级别专业科目管理     | url:exam.do?method=fwdTaskLevelMng        |
| 网报流程设置         | url:exam.do?method=fwdTaskFlowMng         |
| 报考职位管理         | url:exam.do?method=fwdTaskPositionMng     |
| 报考信息采集项设置   | url:exam.do?method=fwdTaskCollMng         |
| 材料采集配置         | url:exam.do?method=fwdTaskMaterialsMng    |
| 考试模板设置         | url:exam.do?method=fwdTaskPrintModelMng   |
| 量化评分标准设置     | url:exam.do?method=fwdTaskQuantMng        |
| 考区信息管理         | url:exam.do?method=fwdTaskAreaMng         |
| 编码规则设置         | url:exam.do?method=fwdTaskEncodingMng     |
| 考试参数管理         | url:exam.do?method=fwdTaskParaMng         |
| 报考职位改报管理     | url:exam.do?method=fwdTaskPosAdjustlMng   |
| 考生加分项目管理     | url:exam.do?method=fwdTaskBunusMng        |
| 黑名单管理           | url:exam.do?method=fwdTaskBlackListMng    |
| 白名单管理           | url:exam.do?method=fwdTaskWhiteListMng    |
| 建造师白名单管理     | url:exam.do?method=fwdConstrWhiteListMng  |
| 导入国家考生数据     | url:exam.do?method=fwdCountryStdImport    |
| 导入考生报考信息     | url:exam.do?method=fwdHealthStdImport     |
| 审核点管理           | url:exam.do?method=fwdTaskSpotMng         |
| 限制考试重复报名管理 | url:exam.do?method=fwdTaskForbidRepeatMng |
| 导入补录考生         | url:exam.do?method=fwdBlStdImportMng      |
| 考试承诺书管理       | url:exam.do?method=fwdTaskPledgeMng       |



#### 考试设置向导

![image-20220722165718864](七月/image-20220722165718864.png)

![image-20220722165753631](七月/image-20220722165753631.png)



![image-20220722165847513](七月/image-20220722165847513.png)

通过批次id来划分不同的系统中的不同功能；

## 7.23-7.24

周末

## 7.25



### 考务系统

查找左侧功能栏的url，有的没找到，不知道怎么回事

| 功能名称             | url地址                                   |
| -------------------- | ----------------------------------------- |
| 考试设置向导         | url:exam.do?method=fwdExamSetting         |
| 考试管理             | url:exam.do?method=fwdExamManage          |
| 考试批次管理         | url:exam.do?method=fwdTaskManage          |
| 级别专业科目管理     | url:exam.do?method=fwdTaskLevelMng        |
| 网报流程设置         | url:exam.do?method=fwdTaskFlowMng         |
| 报考职位管理         | url:exam.do?method=fwdTaskPositionMng     |
| 报考信息采集项设置   | url:exam.do?method=fwdTaskCollMng         |
| 材料采集配置         | url:exam.do?method=fwdTaskMaterialsMng    |
| 考试模板设置         | url:exam.do?method=fwdTaskPrintModelMng   |
| 量化评分标准设置     | url:exam.do?method=fwdTaskQuantMng        |
| 考区信息管理         | url:exam.do?method=fwdTaskAreaMng         |
| 编码规则设置         | url:exam.do?method=fwdTaskEncodingMng     |
| 考试参数管理         | url:exam.do?method=fwdTaskParaMng         |
| 报考职位改报管理     | url:exam.do?method=fwdTaskPosAdjustlMng   |
| 考生加分项目管理     | url:exam.do?method=fwdTaskBunusMng        |
| 黑名单管理           | url:exam.do?method=fwdTaskBlackListMng    |
| 白名单管理           | url:exam.do?method=fwdTaskWhiteListMng    |
| 建造师白名单管理     | url:exam.do?method=fwdConstrWhiteListMng  |
| 导入国家考生数据     | url:exam.do?method=fwdCountryStdImport    |
| 导入考生报考信息     | url:exam.do?method=fwdHealthStdImport     |
| 审核点管理           | url:exam.do?method=fwdTaskSpotMng         |
| 限制考试重复报名管理 | url:exam.do?method=fwdTaskForbidRepeatMng |
| 导入补录考生         | url:exam.do?method=fwdBlStdImportMng      |
| 考试承诺书管理       | url:exam.do?method=fwdTaskPledgeMng       |



#### 考试管理

![image-20220725093018124](七月/image-20220725093018124.png)

为什么返回空呢   不明白

![image-20220725093152833](七月/image-20220725093152833.png)

![image-20220725093252121](七月/image-20220725093252121.png)



![image-20220725093311895](七月/image-20220725093311895.png)

在页面加载时，查询

![image-20220725093413566](七月/image-20220725093413566.png)

![image-20220725094430925](七月/image-20220725094430925.png)

![image-20220725094505220](七月/image-20220725094505220.png)

最后传回jsp页面，并且刷新

千篇一律的流程，去查看底层封装的工具；

#### 考试批次管理

与考试管理一样，进jsp页面首先调用查询方法。

![image-20220725102103315](七月/image-20220725102103315.png)

新增批次

![image-20220725102149192](七月/image-20220725102149192.png)

继承考试

![image-20220725102308798](七月/image-20220725102308798.png)

继承考试，什么意思？

就是将已有的考试信息拷贝一份呗？

![image-20220725102726002](七月/image-20220725102726002.png)

![image-20220725102753630](七月/image-20220725102753630.png)

根据ksid来查询批次信息，肯定只有一个 啊，感觉多此一举

![image-20220725102908374](七月/image-20220725102908374.png)

保存新增批次

![image-20220725102934991](七月/image-20220725102934991.png)

.![image-20220725103001499](七月/image-20220725103001499.png)

首先先进行各种判断，判断数据库中是否存在啦，存在则抛出异常，这种逻辑就是需要比较仔细，大体流程就是新增一个东西，必须要在数据库表中，以及其关联表中判断与之相关的信息是否存在，存在则抛出异常，不存在则将jsp传过来的信息insert到数据库中。

还有一个需要注意的地方

![image-20220725103303808](七月/image-20220725103303808.png)

这个是是否继承批次，如果继承批次则执行此方法

![image-20220725103636472](七月/image-20220725103636472.png)

将继承的考试中的部分信息直接复制到新增的考试批次id

![image-20220725105151512](七月/image-20220725105151512.png)

根据考试流程来进行分析

#### 限制考试重复报名管理

![image-20220725105517450](七月/image-20220725105517450.png)

![image-20220725105546261](七月/image-20220725105546261.png)

![image-20220725110312344](七月/image-20220725110312344.png)

使用instr函数进行查询pcids在另一个pcid出现的位置、

新增限制

![image-20220725111603505](七月/image-20220725111603505.png)

​		直接转到jsp

![image-20220725111628334](七月/image-20220725111628334.png)

​	保存新增限制

![image-20220725115940698](七月/image-20220725115940698.png)

![image-20220725135345159](七月/image-20220725135345159.png)

修改限制

![image-20220725135436788](七月/image-20220725135436788.png)

![image-20220725140212168](七月/image-20220725140212168.png)

![image-20220725140816774](七月/image-20220725140816774.png)

首先回显需要修改的数据，打开新的jsp窗口；

![image-20220725141520575](七月/image-20220725141520575.png)

保存修改

![image-20220725141606106](七月/image-20220725141606106.png)

都非常简单，都是先判断数据库中是否已经存在，然后再去修改数据库中的数据；

#### 网报流程设置

![image-20220725142451203](七月/image-20220725142451203.png)

![image-20220725142833962](七月/image-20220725142833962.png)

新增流程信息

![image-20220725145047405](七月/image-20220725145047405.png)

![image-20220725145114876](七月/image-20220725145114876.png)

![image-20220725145239834](七月/image-20220725145239834.png)

只有没有报过名的考试流程才可以进行添加操作

![image-20220725150220740](七月/image-20220725150220740.png)

保存操作

![image-20220725150357891](七月/image-20220725150357891.png)

老样子，先判断再插入

![image-20220725150500666](七月/image-20220725150500666.png)

查看表结构，以及数据流向；

不看了，去看springcloud；



### 其他任务

看同事的任务来学习

```java
/**
	 * 解析文件列
	 *
	 * @author wlc
	 * @date 创建时间 2022-7-22
	 * @since V1.0
	 */
public final DataMap QueryStdntBylist(final DataMap para) throws Exception {
    String pcid = this.getPcid();
    String kszt = para.getString("kszt","");
    DataMap dm = new DataMap();
    StringBuffer sqlBF = new StringBuffer();

    DataSet dataSets = new DataSet();

    CommonsMultipartFile file = (CommonsMultipartFile) para.get("drwj");// 导入文件
    if (StringUtil.chkStrNull(pcid)) {
        throw new BizException("批次ID获取失败");
    }
    if (null == file) {
        throw new BizException("传入的文件为空。");
    }

    // 获取文件格式
    String fileName = file.getOriginalFilename();
    String fileExt = fileName.substring(fileName.lastIndexOf(".") + 1)
        .toLowerCase();
    DataMap dmFileInfo = new DataMap();
    if ("xls".equalsIgnoreCase(fileExt)) {
        dmFileInfo = this.parseExclFile4ImportResultExamStd(file);
    } else if ("dbf".equalsIgnoreCase(fileExt)) {
        dmFileInfo = this.parseDBFFile4ImportResultExamStd(file);
    } else {
        throw new BizException("不支持文件类型" + fileExt + "的文件导入");
    }

    DataSet dsData = dmFileInfo.getDataSet("dsdata");
    DataSet dsColm = dmFileInfo.getDataSet("dscolm");

    if (dsData.size() <= 0) {
        throw new BizException("导入的数据行数为0");
    }
    if (dsColm.size() <= 0) {
        throw new BizException("导入的数据列数为0");
    }



    for (int i = 0; i < dsData.size(); i++) {
        String yxzjhm = (String) dsData.get(i).get("zjhm");
        String xm = (String) dsData.get(i).get("xm");
        sqlBF.setLength(0);
        sqlBF.append(" select bmid, kqid ");
        sqlBF.append("   from rg.task_stdnt a ");
        sqlBF.append("  where pcid = ? ");
        sqlBF.append(" and yxbz = '1' ");  //有效标志
        sqlBF.append(" and yxzjhm = ? ");
        sqlBF.append(" and xm = ? ");
        if("bmcg".equals(kszt)){
            sqlBF.append(" and exists (select bmid ");   //只打印报名成功
            sqlBF.append("           	 from rg.task_stdnt_flow b ");
            sqlBF.append("          	where a.bmid = b.bmid ");
            sqlBF.append("         	   and b.kslczt = '1' ");
            sqlBF.append("             and b.lcid = '"
                         + TipGlobalVars.FlowId.BMCG + "') ");
        }
        this.sql.setSql(sqlBF.toString());
        this.sql.setString(1, pcid);
        this.sql.setString(2, yxzjhm);
        this.sql.setString(3, xm);
        DataSet dsStd = this.sql.executeQuery();
        dataSets.combineDataSet(dsStd);
    }

    DataMap dmTaskArea = TipUtil.getDmTaskArea(pcid);
    for (int i = 0, len = dataSets.size(); i < len; i++) {
        String bmid = dataSets.getString(i, "bmid");
        String kqid = dataSets.getString(i, "kqid");
        if (dmTaskArea.containsKey(kqid)) {
            dataSets.put(i, "kqdm", dmTaskArea.getDataMap(kqid)
                         .getString("kqdm"));
            dataSets.put(i, "kqmc", dmTaskArea.getDataMap(kqid)
                         .getString("kqmc"));
        } else {
            dataSets.put(i, "kqdm", "");
            dataSets.put(i, "kqmc", "");
        }
        DataMap dmStd = RgUtil.getTaskStdnt(bmid);
        dataSets.getRow(i).putAll(dmStd);
    }
    dataSets.sort("zwdm").sort("kqdm");
    dm.put("dsStd", dataSets);
    return dm;
}
```

首先读取文件中的数据，然后将文件中的数据的字段拿出来做条件，去数据库中查询，查询出来则展示在页面上。

## 7.26

### 任务修改

不要在标准件上面修改；

新加一个客户化的页面；

![image-20220726155845641](七月/image-20220726155845641.png)

将标准件的jsp还原，新增一个客户化

然后去数据库中新增对应的条件，这样的话客户化的页面才可以使用；

![image-20220726160201726](七月/image-20220726160201726.png)

```sql
INSERT INTO FW.LOCAL_DOC values('tip/jsp/or/winOrgnLimitMod.jsp','tip/jsp/or/winOrgnLimitMod_100.jsp','新疆客户化-职位限制条件维护-限制条件修改页面')

INSERT INTO FW.LOCAL_CONFIG  values('100','tip/jsp/or/winOrgnLimitMod.jsp','tip/jsp/or/winOrgnLimitMod_100.jsp')

```

提交git

## 7.27

上午去构思那个手机号码传空值的问题，最后发现，已经修改完了；

其他倒是没干啥

## 7.28

### bas密码重置

![image-20220728090934554](七月/image-20220728090934554.png)

与这个信息修改功能类似，查看信息修改的业务流程；



#### 大体流程

1. 新建密码重置配置表（bi.pass_reset_config）和 密码重置材料配置表（bi.pass_reset_material_config）

2. 添加密码重置管理功能

3. 添加xtlx的code

4. 点击密码重置管理功能按钮，跳转到密码重置页面，并且查询数据;密码重置管理页面搜索条件：项目类型下拉框、考区名称下拉框

   显示字段：项目类型、考区名称、经办人、经办时间、备注

   ```
   密码重置页面：
   应当显示：
   搜索栏：项目类型（下拉框）code       考取名称（下拉框）sql查询       查询    清空
   
   展示的字段名称：
   项目类型    考区名称      经办人     经办时间     备注
   
   
   操作：
   设置材料（就是上传材料）    新增    修改
   ```

5. 新增（只新增：项目类型与考区名称）

6. 设置材料页面：

   页面展示字段：操作栏、材料名称、材料类型、材料说明、级别名称、是否向考生展示、是否必录项、文件大小、文件数量、经办人、经办时间、备注；

7. 设置材料页面-新增材料

   查询材料信息，勾选材料、点击确定

8. 设置材料页面-修改材料

   保存



大概流程就是如此；

#### 1、数据库建表

```SQL
CREATE TABLE BI.PASS_RESET_MATERIAL_CONFIG (
	MMCZCLPZID VARCHAR2(20) NOT NULL,
	CLID VARCHAR2(20) NULL,
    CLMC VARCHAR2(100) NULL,
	CLLX VARCHAR2(20) NULL,
	CLSM VARCHAR2(500) NULL,
	WJDX VARCHAR2(20) NULL,
	SFZS VARCHAR2(3) NULL,
	SFBL VARCHAR2(3) NULL,
	WJSL VARCHAR2(20) NULL,
	JBRID VARCHAR2(20) NULL,
	JBRMC VARCHAR2(50) NULL,
	JBSJ DATE NULL,
	ZHXGRID VARCHAR2(20) NULL,
	ZHXGRMC VARCHAR2(50) NULL,
	ZHXGSJ DATE NULL,
	BZ VARCHAR2(200) NULL,
	CONSTRAINT PK_PASS_RESET_MATERIAL_CONFIG_MMCZCLPZID PRIMARY KEY (MMCZCLPZID)
)
TABLESPACE TS_BI;
COMMENT ON TABLE BI.PASS_RESET_MATERIAL_CONFIG IS '密码重置材料配置表';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.MMCZCLPZID IS '密码重置材料配置ID';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.CLID IS '材料ID';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.CLMC IS '材料名称';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.CLLX IS '材料类型';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.CLSM IS '材料说明';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.WJDX IS '文件大小';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.SFZS IS '是否展示';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.SFBL IS '是否必录';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.WJSL IS '文件数量';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.JBRID IS '经办人ID';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.JBRMC IS '经办人名称';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.JBSJ IS '经办时间';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.ZHXGRID IS '最后修改人ID';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.ZHXGRMC IS '最后修改人名称';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.ZHXGSJ IS '最后修改时间';
COMMENT ON COLUMN BI.PASS_RESET_MATERIAL_CONFIG.BZ IS '备注';

```



```SQL
CREATE TABLE BI.PASS_RESET_CONFIG (
	YWLSH VARCHAR2(20) NOT NULL,
	XTLX VARCHAR2(20) NULL,
	KQID VARCHAR2(20) NULL,
	KQMC VARCHAR2(200) NULL,
	JBRID VARCHAR2(20) NULL,
	JBRMC VARCHAR2(100) NULL,
	JBSJ DATE NULL,
	ZHXGRID VARCHAR2(20) NULL,
	ZHXGRMC VARCHAR2(100) NULL,
	ZHXGSJ DATE NULL,
	BZ VARCHAR2(500) NULL,
	CONSTRAINT PK_PASS_RESET_CONFIG PRIMARY KEY (YWLSH)
)
TABLESPACE TS_BI;
COMMENT ON TABLE BI.PASS_RESET_CONFIG IS '新建密码重置配置表';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.YWLSH IS '业务流水号';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.XTLX IS '系统类型';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.KQID IS '考区ID';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.KQMC IS '考区名称';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.JBRID IS '经办人ID';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.JBRMC IS '经办人名称';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.JBSJ IS '经办时间';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.ZHXGRID IS '最后修改人ID';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.ZHXGRMC IS '最后经办人名称';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.ZHXGSJ IS '最后修改时间';
COMMENT ON COLUMN BI.PASS_RESET_CONFIG.BZ IS '备注';

```

#### 2、添加功能

添加了功能，但是数据库中没有，暂时先搁置，先去写jsp页面

```sql
INSERT INTO FW.FUNC
(DBID, GNID, GNMC, FGN, GNSJ, GNLX, SXH, GNTB, BZ, YWLB)
VALUES('000', 'bar010107', '密码重置管理', 'bar0101', 'url:pwd.do?method=fwdPwdResetManage', 'C', 7, NULL, NULL, 'bas');

```

![image-20220728164749222](七月/image-20220728164749222.png)

新建一个controller

![image-20220728164600428](七月/image-20220728164600428.png)



#### 3、添加code

```
--code
SELECT * from fw.code_doc;
SELECT * from fw.code_config;
SELECT * from fw.code_list;
--功能
SELECT * from fw.func;
SELECT * from fw.func_doc;
SELECT * from fw.func_union;
```



![image-20220728165253273](七月/image-20220728165253273.png)

然后去数据库中找相应的信息

```sql
INSERT INTO FW.CODE_LIST
(DMBH, DMMC, DMSM)
VALUES('xtlx', '系统类型', NULL);

INSERT INTO FW.CODE_DOC
(DMBH, CODE, CONTENT, SM)
VALUES('xtlx', 'A', 'bas', NULL);
INSERT INTO FW.CODE_DOC
(DMBH, CODE, CONTENT, SM)
VALUES('xtlx', 'B', 'tip', NULL);



INSERT INTO FW.CODE_CONFIG
(DBID, DMBH, CODE, CONTENT, XH)
VALUES('000', 'XTLX', 'A', 'tip', 1);
INSERT INTO FW.CODE_CONFIG
(DBID, DMBH, CODE, CONTENT, XH)
VALUES('000', 'XTLX', 'B', 'bas', 2);


```

#### 4、密码重置页面

```java
/**
 * 进入密码重置管理页面
 *
 * @author xzb
 * @date 创建时间 2022-07-28
 * @since V1.0
 */
public final DataMap fwdPwdResetManage(final DataMap para) throws Exception {
    StringBuffer sqlBF = new StringBuffer();

    sqlBF.setLength(0);
    sqlBF.append(" select content code,content content ");
    sqlBF.append("   from  fw.code_doc ");
    sqlBF.append("   where  dmbh = 'XTLX' ");
    sqlBF.append("  group by content ");

    this.sql.setSql(sqlBF.toString());
    DataSet dsXtlx = this.sql.executeQuery();
    DataMap rdm = new DataMap();
    rdm.put("dsxtlx", dsXtlx);
    return rdm;
}
```

## 7.29

### 密码重置管理

#### 1、密码重置管理页面

```jsp
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib uri="easyFrame.tld" prefix="ef"%>
<ef:body>
	<ef:form title="查询条件" name="formQuery">
		<ef:dropdownList name="xtlx" label="项目类型" code="XTLX"
						 ></ef:dropdownList>
		<ef:dropdownList name="kqmc" dsCode="dskqmc" label="考区名称"
						 ></ef:dropdownList>
		<ef:buttons colspan="2" closebutton="false">
			<ef:button value="查询" onclick="btnQueryClick();"></ef:button>
			<ef:button value="清空" onclick="btnClearClick();"></ef:button>
		</ef:buttons>
	</ef:form>

	<ef:queryGrid name="gridPwdResetManage" title="密码重置申请（该窗口只展示查询结果的前1000条，如需查询其他，请精确查询条件）">
		<ef:columnText name="ywlsh" label="业务流水号" hidden="true" />
		<ef:columnText name="xmbh" label="项目类型" width="4" />
		<ef:columnText name="xmmc" label="考区名称" width="8" />
		<ef:columnText name="jbrmc" label="经办人" width="6" />
		<ef:columnText name="jbsj" label="经办时间" dataType="date"
					   mask="yyyy-MM-dd hh:mm:ss" sourceMask="yyyyMMddhhmmss" width="12" />
		<ef:columnText name="bz" label="备注" width="20" />
	</ef:queryGrid>
	<ef:form border="false">
		<ef:buttons align="right" colspan="6">
			<ef:button value="新增" onclick="btnAddClick();"></ef:button>
			<ef:button value="设置材料" onclick="btnDelClick();"></ef:button>
		</ef:buttons>
	</ef:form>
</ef:body>
<script type="text/javascript">

	function onLoadComplete() {
		btnQueryClick();
	}

	// 清空查询条件数据
	function btnClearClick() {
		getObject("formQuery").clear();
		getObject("gridBusInfoChange").clear();
	}

	// 根据条件查询
	function btnQueryClick() {
		var url = new URL("pwd.do", "queryPwdResetManage");
		url.addForm("formQuery");
		AjaxUtil.asyncRefreshBizData(url, "gridPwdResetManage:dsmmcz");
	}

	// 新增密码重置项
	function btnAddClick() {
		var url = new URL("pwd.do", "fwdPwdResetAdd");
		openWindow("新增密码重置信息", null, url, 700, 300, function(data) {
			btnQueryClick();
		});
	}
</script>
```



#### 2、进入

```java
 /**
     * 进入密码重置管理页面
     *
     * @author xzb
     * @date 创建时间 2022-07-28
     * @since V1.0
     */
    public ModelAndView fwdPwdResetManage(HttpServletRequest request,
                                          HttpServletResponse response, DataMap para) throws Exception {
        DataMap rdm = this.doBizMethod("com.grace.bas.pwd.biz.PwdBiz", "fwdPwdResetManage", para);
        return new ModelAndView("bas/jsp/pwd/winPwdResetManage.jsp", rdm);
    }
```

查询

```java
/**
     * 查询密码重置管理申请信息
     *
     * @author xzb
     * @date 创建时间 2022-07-29
     * @since V1.0
     */
public ModelAndView queryPwdResetManage(HttpServletRequest request,
                                        HttpServletResponse response, DataMap para) throws Exception {

    DataMap dm = this.doBizMethod("com.grace.bas.pwd.biz.PwdBiz", "queryPwdResetManage", para);
    return this.refreshData(response, dm);
}
```

```java
/**
     * 获取密码重置申请信息
     *
     * @author xzb
     * @date 创建时间 2022-7-29
     * @since V1.0
     */
public final DataMap queryPwdResetManage(final DataMap para) throws Exception {
    StringBuffer sqlBF = new StringBuffer();

    String xtlx = para.getString("xtlx");
    String kqmc = para.getString("kqmc");

    sqlBF.setLength(0);
    sqlBF.append(" select pr.ywlsh, pr.xtlx, pr.kqid, pr.kqmc, pr.jbrid, ");
    sqlBF.append("        pr.jbrmc, to_char(pr.jbsj, 'yyyyMMddhh24mmss') jbsj, pr.zhxgrid, pr.zhxgrmc, ");
    sqlBF.append("        to_char(pr.zhxgsj, 'yyyyMMddhh24mmss') zhxgsj, pr.bz ");
    sqlBF.append("   from bi.pass_reset_config pr ");
    sqlBF.append("  where pr.xtlx = nvl(?, pr.xtlx) ");
    sqlBF.append("    and pr.kqmc = nvl(?, pr.kqmc) ");

    this.sql.setSql(sqlBF.toString());
    this.sql.setString(1, xtlx);
    this.sql.setString(2, kqmc);
    DataSet dsMmcz = this.sql.executeQuery(0, 1000);

    dsMmcz.sortdesc("jbsj");

    DataMap rdm = new DataMap();
    rdm.put("dsmmcz", dsMmcz);
    return rdm;

}
```



#### 3、新增

```java
/**
     * 进入密码重置项新增页面
     *
     * @author xzb
     * @date 创建时间 2022-07-28
     * @since V1.0
     */
    public ModelAndView fwdPwdResetAdd(HttpServletRequest request,
                                       HttpServletResponse response, DataMap para) throws Exception {
        DataMap rdm = this.doBizMethod("com.grace.bas.pwd.biz.PwdBiz", "fwdPwdResetManage", para);

        return new ModelAndView("bas/jsp/pwd/winPwdResetAdd.jsp",rdm);
    }
```



```java
/**
     * 进入密码重置管理页面
     *
     * @author xzb
     * @date 创建时间 2022-07-28
     * @since V1.0
     */
    public final DataMap fwdPwdResetManage(final DataMap para) throws Exception {
        StringBuffer sqlBF = new StringBuffer();
        sqlBF.setLength(0);//查询kqmc下拉框数据
        sqlBF.append(" select kqmc code, kqmc content ");
        sqlBF.append("   from  ba.area ");
        sqlBF.append("   group by kqmc ");
        this.sql.setSql(sqlBF.toString());
        DataSet dsKqmc = this.sql.executeQuery();


        DataMap rdm = new DataMap();
        rdm.put("dskqmc", dsKqmc);
        return rdm;
    }
```



#### 4、保存

参考代码

```java
/**
	 * 保存计算机证书申请信息修改
	 * 
	 * @author wn
	 * @date 创建时间 2019-5-14
	 * @since V1.0
	 */
	public final DataMap saveComputerCertRegrantModify(final DataMap para) throws Exception {
		StringBuffer sqlBF = new StringBuffer();

		String mkdm = para.getString("mkdm");
		if (StringUtil.chkStrNull(mkdm)) {
			throw new BizException("模块名称不能为空，请重新修改！");
		}

		String zsglh = para.getString("zsglh");
		String zsyzh = para.getString("zsyzh", "");
		String ywlsh = para.getString("ywlsh", "");
		String ryid = para.getString("ryid");
		String pcid = para.getString("pcid", "");

		String dah = para.getString("dah");
		String bmd = para.getString("bmd");

		if (StringUtil.chkStrNull(pcid)) {
			throw new BizException("批次ID获取失败，请重新修改！");
		}
		if (StringUtil.chkStrNull(zsyzh)) {
			throw new BizException("证书印制号为空，请重新修改！");
		}
		if (StringUtil.chkStrNull(ywlsh)) {
			throw new BizException("业务流水号为空，请重进入新修改！");
		}

		 
		this.sql.setSql(sqlBF.toString());
		this.sql.setString(1, pcid);
		DataSet dsTemp = this.sql.executeQuery();

		String mkmc = dsTemp.toString("jbmc");
		if (StringUtil.chkStrNull(mkmc)) {
			throw new BizException("模块名称为空，请重新选择！");
		}

		sqlBF.setLength(0);
		sqlBF.append(" update ba.computer_cert_regrant  ");
		sqlBF.append("    set mkmc  = ?, ");
		sqlBF.append("        mkdm  = ?, ");
		sqlBF.append("        zsglh = ?, ");
		sqlBF.append("        zsyzh = ?, ");
		sqlBF.append("        dah  = ?, ");
		sqlBF.append("        bmd  = ?  ");
		sqlBF.append("  where ywlsh = ?  ");
		sqlBF.append("    and ryid  = ?  ");
		this.sql.setSql(sqlBF.toString());
		this.sql.setString(1, mkmc);
		this.sql.setString(2, mkdm);
		this.sql.setString(3, zsglh);
		this.sql.setString(4, zsyzh);
		this.sql.setString(5, dah);

		this.sql.setString(6, bmd);
		this.sql.setString(7, ywlsh);
		this.sql.setString(8, ryid);
		this.sql.executeUpdate();
		this.log("BA-L-BCJSJSSQXXXG", "保存计算机证书申请信息修改", "L", ywlsh, "保存计算机证书申请信息修改", "ywlsh="
				+ ywlsh + ",ryid=" + ryid);
		return null;
	}

```

![image-20220729115626943](七月/image-20220729115626943.png)

首先将多选框中的字段编码查询出来，然后将这些编码试用增强for循环来遍历插入

```java
/**
     * 密码重置新增
     *
     * @author xzb
     * @date 创建时间 2022-07-29
     * @since V1.0
     */
    public final DataMap savePwdResetAdd(final DataMap para) throws Exception {
        String xtlx_code = para.getTrimString("xtlx");
        //将code值转换成content
        String xtlx = CodeUtil.discode("XTLX", xtlx_code);
        String kqmcTemp = para.getTrimString("kqid");
        String ywlsh = "";
        String kqid = "";
        String kqmc = "";

        if (StringUtil.chkStrNull(xtlx_code)) {
            throw new BizException("系统类型不能为空！");
        }
        if (StringUtil.chkStrNull(kqmcTemp)) {
            throw new BizException("考区名称不能为空！");
        }
        StringBuffer sqlBF = new StringBuffer();
        // 获取考区id
        sqlBF.setLength(0);
        sqlBF.append(" select a.kqid ");
        sqlBF.append("   from ba.area a ");
        sqlBF.append("   where a.kqmc in (" + StringUtil.replaceC2QCQ(kqmcTemp)
                + ") ");
        this.sql.setSql(sqlBF.toString());
        DataSet dsTemp = this.sql.executeQuery();

        String kqidTemp = dsTemp.toString("kqid");
        if (StringUtil.chkStrNull(kqidTemp)) {
            throw new BizException("考区ID为空，请重新选择！");
        }
        //将考区id，与考区名称从多选中取出，分别加入数据库中
        String[] kqids =kqidTemp.split(",");
        String[] kqmcs = kqmcTemp.split(",");
        for (int i = 0; i < kqids.length; i++) {
            kqid = kqids[i];
            kqmc = kqmcs[i];
            //首先进行判断，看数据库中是否已经存在
            this.sql.setSql(" select 1 from bi.pass_reset_config where xtlx = ? and kqid = ? ");
            this.sql.setString(1, xtlx);
            this.sql.setString(2, kqid);
            DataSet dsTemp2 = this.sql.executeQuery();

            if (dsTemp2.size() > 0) {
                throw new BizException("新增的系统类型为："+xtlx+",考区名称为："+kqmc+"的申请已存在，请重新添加！");
            }
            sqlBF.setLength(0);
            sqlBF.append(" insert into bi.pass_reset_config ");
            sqlBF.append("   (ywlsh, xtlx, kqid, kqmc, jbrid, ");
            sqlBF.append("    jbrmc, jbsj, zhxgrid, zhxgrmc, zhxgsj, bz) ");
            sqlBF.append(" values ");
            sqlBF.append("   (?, ?, ?, ?, ?, ?, ");
            sqlBF.append("    sysdate, ?, ?, sysdate, ?) ");
            ywlsh = SeqUtil.getId("BA.SEQ_YWLSH");
            this.sql.setSql(sqlBF.toString());
            this.sql.setString(1, ywlsh);
            this.sql.setString(2, xtlx);
            this.sql.setString(3, kqid);
            this.sql.setString(4, kqmc);
            this.sql.setString(5, this.getYhid());
            this.sql.setString(6, this.getYhmc());
            this.sql.setString(7, this.getYhid());
            this.sql.setString(8, this.getYhmc());
            this.sql.setString(9, "");
            this.sql.executeUpdate();
        }
        this.log("BA-H-XZMMCZ", "新增密码重置", "H", ywlsh, "新增密码重置", "ywlsh=" + ywlsh
                + ",xtlx=" + xtlx + ",kqmc=" + kqmcTemp + ",kqid=" + kqids);
        return null;
    }
```

需要进行添加判断，试用xtlx与考区id做判断条件

#### 5、设置材料

```java
//设置材料
function btnModifyClick() {
    var url = new URL("pwd.do", "fwdSetMaterial");
    openWindow("设置材料", null, url, 1350, 700, function (data) {
        if (chkObjNull(data)) {
            return;
        }
    });
}
```

```java
/**
     * 进入设置材料页面
     *
     * @author xzb
     * @date 创建时间 2022-07-29
     * @since V1.0
     */
    public ModelAndView fwdSetMaterial(HttpServletRequest request,
                                           HttpServletResponse response, DataMap para) throws Exception {
        return new ModelAndView("bas/jsp/pwd/pageSetMaterial.jsp", para);
    }
   /**
     * 查询密码重置材料
     *
     * @author xzb
     * @date 创建时间 2022-07-29
     * @since V1.0
     */
    public ModelAndView querySetMeterialInfo(HttpServletRequest request,
                                       HttpServletResponse response, DataMap para) throws Exception {
        DataMap dm = this.doBizMethod("com.grace.bas.pwd.biz.PwdBiz", "querySetMeterialInfo", para);
        return this.refreshData(response, dm);
    }
```

```java
/**
     * 密码重置管理——设置材料查询
     *
     * @author xzb
     * @date 创建时间 2022-07-29
     * @since V1.0
     */
    public final DataMap querySetMeterialInfo(final DataMap para) throws Exception {
        StringBuffer sqlBF = new StringBuffer();
        // 查询密码重置材料
        sqlBF.setLength(0);
        sqlBF.append(" select mmczclpzid, clid, clmc, cllx, clsm, wjdx,  ");
        sqlBF.append("        sfzs, sfbl, wjsl, jbrmc, ");
        sqlBF.append("        to_char(jbsj, 'yyyyMMddhh24mmss') jbsj, zhxgrmc, ");
        sqlBF.append("        to_char(zhxgsj, 'yyyyMMddhh24mmss') zhxgsj ");
        sqlBF.append("   from bi.pass_reset_material_config ");
        sqlBF.append("  group by mmczclpzid, clid, clmc, cllx, clsm, wjdx, wjsl, sfzs, sfbl, jbrmc, jbsj, zhxgrmc, zhxgsj");
        this.sql.setSql(sqlBF.toString());
        DataSet dsMmczMeterial = this.sql.executeQuery();
        DataMap rdm = new DataMap();
        rdm.put("dsmmczmeterial", dsMmczMeterial.sort("jbsj"));
        return rdm;
    }
```

#### 6、新增材料

```js
 // 新增
    function btnAddClick() {
        var url = new URL("pwd.do", "fwdSetMeterialAdd");
        openWindow("材料新增", url, "normal", function(data) {
            AjaxUtil.asyncRefreshPage();
        });
    }
```

```java
/**
     * 进入材料新增页面
     *
     * @author xzb
     * @date 创建时间 2022-07-29
     * @since V1.0
     */
    public ModelAndView fwdSetMeterialAdd(HttpServletRequest request,
                                       HttpServletResponse response, DataMap para) throws Exception {
        DataMap rdm = this.doBizMethod("com.grace.bas.pwd.biz.PwdBiz", "fwdSetMeterialAdd", para);
        return new ModelAndView("bas/jsp/pwd/winSetMaterial.jsp", rdm);
    }
```

```java
/**
     * 转向添加密码重置材料页面
     *
     * @author xzb
     * @date 创建时间 2022-7-29
     * @since V1.0
     */
    public final DataMap fwdSetMeterialAdd(final DataMap para) throws Exception {
        StringBuffer sqlBF = new StringBuffer();

        sqlBF.setLength(0);
        sqlBF.append(" select a.clid, clmc, cllx, clsm, jbr, ");
        sqlBF.append("        wjdx, wjsl, bz, ");
        sqlBF.append("   to_char(jbsj, 'yyyyMMddhh24mmss') jbsj ");
        sqlBF.append("   from bi.material a ");
        sqlBF.append("    where not exists (select b.clid ");
        sqlBF.append("           from bi.pass_reset_material_config b ");
        sqlBF.append("          where a.clid = b.clid) ");
        sqlBF.append("  group by a.clid, clmc, cllx, clsm, jbr, jbsj, wjdx, wjsl, bz");
        this.sql.setSql(sqlBF.toString());
        DataSet dsFlow = this.sql.executeQuery();
        DataMap rdm = new DataMap();
        rdm.put("dsFlow", dsFlow.sort("jbsj"));
        return rdm;
    }
```



```jsp
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib uri="easyFrame.tld" prefix="ef"%>
<%
    String pcid = (String) request.getAttribute("pcid");
%>
<ef:body>
    <ef:queryGrid name="gridFlow" title="可选材料信息" dataSource="dsflow"
                  multi="true" height="12">
        <ef:columnText name="clid" label="材料id" hidden="true" />
        <ef:columnText name="clmc" label="材料名称" width="10" />
        <ef:columnDropDown label="材料类型" name="cllx" code="CLLX" width="5"
                           align="center" />
        <ef:columnText name="clsm" label="材料说明" width="20" />
        <ef:columnText name="jbr" label="经办人" width="6" />
        <ef:columnText name="jbsj" label="经办时间" dataType="date"
                       mask="yyyy-MM-dd hh:mm:ss" sourceMask="yyyyMMddhhmmss" width="12" />
    </ef:queryGrid>
    <ef:buttons>
        <ef:button value="保存" onclick="btnSaveClick();"></ef:button>
    </ef:buttons>
</ef:body>
<script type="text/javascript">
    //保存
    function btnSaveClick() {
        var grid = getObject("gridFlow");
        if (!grid.isSelectRow()) {
            alert("请先选择要添加的流程信息。");
            return;
        }

        var url = new URL("exam.do", "saveTaskFlowAdd");
        url.addQueryGridSelectData("gridFlow");
        url.addPara("pcid", "<%=pcid%>");
        var data = AjaxUtil.syncBizRequest(url);
        if (AjaxUtil.checkIsGoOn(data)) {
            alert("添加成功。");
            closeWindow("ok");
        }
    }
</script>
```

#### 7、保存新增材料

```java
 /**
     * 材料新增--保存
     *
     * @author xzb
     * @date 创建时间 2022-7-29
     * @since V1.0
     */
    public final DataMap saveSetMaterialAdd(final DataMap para) throws Exception {
        StringBuffer sqlBF = new StringBuffer();
        String clid, wjdx, wjsl, bz, clmc, cllx, clsm, mmczclpzid;
        DataSet dsFlow = para.getDataSet("gridFlow");

        if (dsFlow.size() == 0) {
            throw new BizException("请选择要添加的密码重置材料。");
        }

        for (int i = 0, len = dsFlow.size(); i < len; i++) {
            mmczclpzid = SeqUtil.getId("BI.SEQ_MMCZCLPZID");
            clid = dsFlow.getString(i, "clid");
            wjdx = dsFlow.getString(i, "wjdx");
            wjsl = dsFlow.getString(i, "wjsl");
            bz = dsFlow.getString(i, "bz");
            clmc = dsFlow.getString(i, "clmc");
            cllx = dsFlow.getString(i, "cllx");
            clsm = dsFlow.getString(i, "clsm");
            sqlBF.setLength(0);
            sqlBF.append(" insert into bi.pass_reset_material_config ");
            sqlBF.append("   (mmczclpzid, clid, clmc, cllx, clsm, ");
            sqlBF.append("    wjdx,sfzs,sfbl, wjsl, jbrid, jbrmc, jbsj, ");
            sqlBF.append("    zhxgrid, zhxgrmc, zhxgsj, bz) ");
            sqlBF.append(" values ");
            sqlBF.append("   (?, ?, ?, ?, ?, ");
            sqlBF.append("    ?, 1, 1, ?, ?, ?, sysdate, ");
            sqlBF.append("    ?, ?, sysdate, ?)");
            this.sql.setSql(sqlBF.toString());
            this.sql.setString(1, mmczclpzid);
            this.sql.setString(2, clid);
            this.sql.setString(3, clmc);
            this.sql.setString(4, cllx);
            this.sql.setString(5, clsm);

            this.sql.setString(6, wjdx);
            this.sql.setString(7, wjsl);
            this.sql.setString(8, this.getYhid());
            this.sql.setString(9, this.getYhmc());


            this.sql.setString(10, this.getYhid());
            this.sql.setString(11, this.getYhmc());
            this.sql.setString(12, bz);
            this.sql.executeUpdate();
        }
        // 记录日志
        this.log("BI-H-BCMMCZCL", "保存密码重置材料", "H", this.getYhid(), "保存密码重置材料", "yhid="
                + this.getYhid());
        return null;
    }

```

```
create sequence BI.SEQ_MMCZCLPZID
minvalue 10000000000
maxvalue 99999999999
start with 10000000001
increment by 1
nocache
cycle;
```

设置材料的查询页面有点问题，下周再弄